<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Home - Brand</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kaushan+Script&amp;display=swap">
    <link rel="stylesheet" href="style.css">
    
</head>

<body id="page-top" data-bs-spy="scroll" data-bs-target="#mainNav" data-bs-offset="54">
    <nav class="navbar navbar-dark navbar-expand-lg fixed-top bg-dark" id="mainNav">
        <div class="container"><a class="navbar-brand" href="index.html">P0ST-GAMES</a><button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler navbar-toggler-right" type="button" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto text-uppercase">
                    <li class="nav-item"><a class="nav-link" href="index.html">Início</a></li>
                    <li class="nav-item"><a class="nav-link" href="lista.html">ListaGEM</a></li>
                    <li class="nav-item"><a class="nav-link" href="grupo.html">integrantes</a></li>
                    <li class="nav-item"></li>
                    <li class="nav-item"></li>
                </ul>
            </div>
        </div>
    </nav>
    <section class="page-section">
        <div class="container">
            <div id="listagem">
                <!-- aqui vão entrar as pessoas -->
        
                <div class="text-center">
                    <h2 class="section-heading text-white">Lista de Jogos</h2>
                    <h3 class="section-subheading text-muted">lista de jogos já enviados</h3>
                </div>       
            </div>
            <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>

            <script>
                // chamada ao backend
                var rota = 'http://localhost:5000/listar.py';
        
                // chamada ajax
                var acao = $.ajax({
                    url: rota,
                    //method: 'GET',
                    dataType: 'json', // os dados são recebidos no formato json,
                });
        
                // se a chamada der certo
                acao.done(function (retorno) {
                    // faz uma proteção contra erros
                    try {
                        if (retorno.resultado == "ok") {
                            // percorrer a lista de pessoas retornadas; 
                            for (var p of retorno.detalhes) { //p vai valer cada pessoa do vetor de pessoas
                                // https://stackoverflow.com/questions/8069663/avoiding-html-in-string-html-in-a-jquery-script
                                // criar um parágrafo
                                var paragrafo = $("<p>");
                                // informar o HTML deste parágrafo
                                // observe o apóstrofo inclinado, para interpretar as variáveis
                                paragrafo.html(`==> ${p.nome}, ${p.email}`);
                                // adicionar o parágrafo criado na div
                                $('#listagem').append(paragrafo);
                            }
                        } else {
                            alert("Erro informado pelo backend: " + retorno.detalhes);
                        }
                    } catch (error) { // se algo der errado...
                        alert("Erro ao tentar fazer o ajax: " + error +
                            "\nResposta da ação: " + retorno.detalhes);
                    }
                });
        
                // se a chamada der erro
                acao.fail(function (jqXHR, textStatus) {
                    mensagem = encontrarErro(jqXHR, textStatus, rota);
                    alert("Erro na chamada ajax: " + mensagem);
                });
        
                // função para encontrar o erro
                // https://stackoverflow.com/questions/6792878/jquery-ajax-error-function 
                function encontrarErro(jqXHR, textStatus, rota) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Não foi possível conectar, ' +
                            'verifique se o endereço do backend está certo' +
                            ' e se o backend está rodando.';
                    } else if (jqXHR.status == 404) {
                        msg = 'A URL informada não foi encontrada no ' +
                            'servidor [erro 404]: ' + rota;
                    } else if (jqXHR.status == 500) {
                        msg = 'Erro interno do servidor [erro 500], ' +
                            'verifique nos logs do servidor';
                    } else if (textStatus === 'parsererror') {
                        msg = 'Falha ao decodificar o resultado json';
                    } else if (textStatus === 'timeout') {
                        msg = 'Tempo excessivo de conexão, estourou o limite (timeout)';
                    } else if (textStatus === 'abort') {
                        msg = 'Requisição abortada (abort)';
                    } else {
                        msg = 'Erro desconhecido: ' + jqXHR.responseText;
                    }
                    return msg;
                }
            </script>
        
</body>

</html>